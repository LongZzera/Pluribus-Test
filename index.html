<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLURIBUS: A JUN√á√ÉO</title>
    <style>
/* Configura√ß√£o Geral */
body, html {
    margin: 0; padding: 0; width: 100%; height: 100%;
    font-family: 'Courier New', Courier, monospace;
    background-color: #000; color: #fff;
    overflow: hidden; text-shadow: 0 0 3px #fff;
}
body::after {
    content: " "; display: block; position: absolute; top: 0; left: 0;
    width: 100%; height: 100%;
    background: repeating-linear-gradient(0deg, rgba(0, 0, 0, 0.3),
    rgba(0, 0, 0, 0.3) 1px, transparent 1px, transparent 2px);
    pointer-events: none; z-index: 9999;
}
.screen {
    width: 100vw; height: 100vh; display: none; position: absolute;
    top: 0; left: 0; align-items: center; justify-content: center;
    flex-direction: column; overflow-y: auto; padding: 20px; box-sizing: border-box;
}
.screen.active { display: flex; }
.hidden { display: none !important; }

/* Menus */
.menu-container {
    text-align: center; background: rgba(10, 10, 10, 0.9);
    padding: 40px; border: 2px solid #ff0;
    box-shadow: inset 0 0 15px #ff0; max-width: 800px;
}
.menu-container h1 { color: #ff0; text-shadow: 0 0 10px #ff0; font-size: 2.5em; }
.menu-container h2 { color: #ff0; text-shadow: 0 0 8px #ff0; }
.menu-container p { color: #fff; margin: 10px 0; }
button {
    display: inline-block; padding: 10px 20px; margin: 5px;
    font-family: 'Courier New', Courier, monospace; font-size: 1.1em;
    font-weight: bold; background-color: #ff0; color: #000;
    border: none; cursor: pointer; text-shadow: none;
    transition: background-color 0.2s, color 0.2s;
}
button:hover { background-color: #000; color: #ff0; border: 1px solid #ff0; }
button:disabled { background: #333; color: #555; border: none; cursor: not-allowed; }
.setting-item { margin: 20px 0; }

/* HUD */
#game-screen { justify-content: flex-start; }
#game-hud {
    width: 100%; padding: 10px; background: #000;
    border-bottom: 2px solid #ff0; display: flex;
    justify-content: space-between; box-sizing: border-box;
    position: absolute; top: 0; z-index: 10;
}
.hud-column { width: 48%; }
.hud-item { font-size: 1em; color: #fff; margin-bottom: 5px; }
#clock-display {
    font-size: 1.5em; color: #ff0; text-shadow: 0 0 5px #ff0; text-align: right;
}
#sanity-bar-container, #intimacy-bar-container, #door-health-bar-container {
    width: 100%; height: 20px; background: #111;
    border: 1px solid #ff0; margin-top: 2px;
}
#sanity-bar, #intimacy-bar, #door-health-bar {
    width: 100%; height: 100%; background: #fff;
    transition: width 0.5s, background-color 0.5s;
}
#intimacy-bar { background: #0f0; }
#door-health-bar { background: #0ff; } /* Cor ciano para sa√∫de da porta */

/* Hub do Apartamento */
#apartment-hub-view {
    width: 100%; height: 100%; display: flex;
    align-items: center; justify-content: center; padding-top: 150px; /* Mais espa√ßo para o HUD */
}
.hub-container { width: 90%; max-width: 900px; text-align: center; }
#apartment-art {
    font-size: 1.2em; color: #fff; border: 2px solid #fff;
    padding: 15px; text-align: left; white-space: pre;
}
.hub-actions button { font-size: 1.1em; padding: 10px 15px; margin: 5px; }
#hub-door-btn {
    color: #ff0; background: #000; border: 1px solid #ff0;
    animation: pulse 1s infinite;
}
@keyframes pulse {
    0% { box-shadow: 0 0 5px #ff0; }
    50% { box-shadow: 0 0 20px #ff0; }
    100% { box-shadow: 0 0 5px #ff0; }
}
#hub-display-log {
    margin-top: 20px; border: 2px solid #555; background: #080808;
    width: 100%; min-height: 60px; padding: 10px;
    font-style: italic; color: #aaa; box-sizing: border-box;
}

/* Visor (Peephole) */
#peephole-overlay {
    position: absolute; width: 100vw; height: 100vh;
    background: rgba(0, 0, 0, 0.95); display: flex;
    align-items: center; justify-content: center;
    flex-direction: column; z-index: 100;
}
#visitor-ascii-art {
    font-size: 1em; line-height: 1; white-space: pre;
    background: #080808; border: 3px solid #ff0; padding: 20px;
    width: 500px; height: 300px; overflow: auto;
    box-shadow: inset 0 0 20px #ff0; color: #fff;
}
#peephole-ui { margin-top: 10px; text-align: center; }
#tool-display {
    border: 1px solid #ff0; background: #000; color: #ff0;
    text-shadow: 0 0 5px #ff0; padding: 5px;
    margin-bottom: 10px; font-size: 0.9em; min-height: 20px;
}
#dialogue-options button { background: #ff0; color: #000; margin: 5px; }
#decision-buttons button { font-size: 1.3em; margin: 10px; }
#exit-peephole-btn { position: absolute; bottom: 20px; right: 20px; }
#scan-visitor-btn {
    border: 1px solid #0ff; color: #0ff; background: #000;
    text-shadow: 0 0 5px #0ff;
}
#scan-visitor-btn:hover { background: #0ff; color: #000; }
#scan-visitor-btn:disabled {
    border-color: #333; color: #555; text-shadow: none;
    background: #111; cursor: not-allowed;
}


/* Tela de Reuni√£o (Discord) */
#meeting-screen {
    background: #1a1a1a;
}
.meeting-container {
    width: 90%; max-width: 1000px; text-align: center; padding: 20px;
}
.meeting-title {
    color: #ff0; text-shadow: 0 0 10px #ff0; font-size: 2em;
    margin-bottom: 20px;
}
.group-grid {
    display: grid; grid-template-columns: repeat(3, 1fr);
    gap: 15px; margin: 20px 0;
}
.member-card {
    background: #2a2a2a; border: 2px solid #555;
    padding: 15px; cursor: pointer; transition: all 0.3s;
}
.member-card:hover { border-color: #ff0; box-shadow: 0 0 10px #ff0; }
.member-card.selected { border-color: #0f0; box-shadow: 0 0 15px #0f0; }
.member-name { color: #ff0; font-size: 1.3em; margin-bottom: 10px; }
.member-status { color: #aaa; font-size: 0.9em; margin-bottom: 5px; }
.intimacy-level {
    color: #0f0; font-size: 1em; margin-top: 10px;
}
.interaction-panel {
    background: #080808; border: 2px solid #ff0;
    padding: 20px; margin-top: 20px; min-height: 200px;
}
.interaction-buttons button {
    display: block; width: 100%; margin: 10px 0;
}

/* TV Screen */
#tv-watch-screen { background: #0a0a0a; }
#tv-art { color: #ff0; text-shadow: 0 0 5px #ff0; }
#tv-dialogue-box {
    border: 1px solid #aaa; background: #111;
    padding: 10px; margin: 20px 0; min-height: 80px;
}
#tv-choices button { display: block; width: 100%; margin: 10px 0; }

/* Mission Screen */
#task-choices button { display: block; width: 100%; margin: 10px 0; text-align: left; }

/* Game Over Screen */
#game-over-stats {
    border: 2px solid #ff0;
    background: #080808;
    padding: 20px;
    margin-top: 20px;
    width: 100%;
    max-width: 600px;
    text-align: left;
}
#game-over-stats h3 {
    color: #ff0;
    text-align: center;
    border-bottom: 1px solid #ff0;
    padding-bottom: 10px;
}
#stats-breakdown {
    white-space: pre-wrap;
    font-size: 1.1em;
    line-height: 1.6;
}
#final-ranking {
    font-size: 3em;
    color: #ff0;
    text-shadow: 0 0 15px #ff0;
    text-align: center;
    margin-top: 20px;
}

/* Credits */
.credits-text {
    color: #aaa; font-size: 0.9em; margin-top: 30px;
    border-top: 1px solid #555; padding-top: 20px;
}
    </style>
</head>
<body>

    <div id="loading-screen" class="screen active">
        <h1>CARREGANDO...</h1>
    </div>

    <div id="main-menu-screen" class="screen">
        <div class="menu-container">
            <h1>PLURIBUS: A JUN√á√ÉO</h1>
            <p>EDI√á√ÉO HIVE MIND</p>
            <div id="audio-status" style="margin: 20px 0; padding: 10px; background: rgba(255,255,0,0.2); border: 1px solid #ff0;">
                <p style="color: #ff0; font-size: 0.9em;">üîä Status do √Åudio: <span id="audio-state">Verificando...</span></p>
                <button id="enable-audio-btn" style="display: none;">HABILITAR √ÅUDIO</button>
            </div>
            <button id="start-game-btn">INICIAR JOGO</button>
            <button id="how-to-play-btn">COMO JOGAR</button>
            <button id="settings-btn">CONFIGURA√á√ïES</button>
            <button id="credits-btn">CR√âDITOS</button>
        </div>
    </div>

    <div id="how-to-play-screen" class="screen">
        <div class="menu-container">
            <h2>COMO JOGAR</h2>
            <p style="text-align: left; max-width: 600px; margin: 20px auto;">
                <strong>OBJETIVO:</strong> Sobreviva 8 dias e complete 8 tasks com seu grupo.<br><br>
                <strong>MEC√ÇNICA:</strong><br>
                ‚Ä¢ Cada dia dura 5 minutos reais<br>
                ‚Ä¢ Visitantes batem na porta a cada hora<br>
                ‚Ä¢ Mantenha SANIDADE e INTIMIDADE acima de 60%<br>
                ‚Ä¢ Mantenha a SA√öDE DA PORTA acima de 0%<br>
                ‚Ä¢ Recusar visitantes pode danificar a porta<br>
                ‚Ä¢ Use FOCAR para recuperar sanidade (3x/dia)<br>
                ‚Ä¢ Use CONSERTAR PORTA para reparar a porta (gasta 1h)<br>
                ‚Ä¢ Use o SCANNER BIOL√ìGICO no visor (1x/dia)<br>
                ‚Ä¢ Complete 1 task por dia na reuni√£o do grupo<br><br>
                <strong>CUIDADO:</strong> Se intimidade < 60% (expuls√£o), sanidade = 0% (jun√ß√£o), ou porta = 0% (invas√£o), o jogo acaba!
            </p>
            <button class="back-to-menu-btn">VOLTAR</button>
        </div>
    </div>

    <div id="credits-screen" class="screen">
        <div class="menu-container">
            <h2>CR√âDITOS</h2>
            <div class="credits-text">
                <p><strong>CRIADOR DO JOGO</strong></p>
                <p style="color: #ff0; font-size: 1.5em;">HALDO</p>
                <br>
                <p><strong>CONCEITO ORIGINAL</strong></p>
                <p>PLURIBUS: A JUN√á√ÉO</p>
                <br>
                <p><strong>PROGRAMA√á√ÉO E DESIGN</strong></p>
                <p>HALDO</p>
                <br>
                <p><strong>ANO</strong></p>
                <p>2025</p>
                <br>
                <p style="color: #555; font-size: 0.8em;">
                    "Mantenha-se infeliz. Mantenha-se vivo."
                </p>
            </div>
            <button class="back-to-menu-btn">VOLTAR</button>
        </div>
    </div>

    <div id="settings-screen" class="screen">
        <div class="menu-container">
            <h2>CONFIGURA√á√ïES</h2>
            <div class="setting-item">
                <label for="music-volume">Volume (M√∫sica):</label>
                <input type="range" id="music-volume" min="0" max="1" step="0.1" value="0.5">
            </div>
            <div class="setting-item">
                <label for="sfx-volume">Volume (Efeitos):</label>
                <input type="range" id="sfx-volume" min="0" max="1" step="0.1" value="0.5">
            </div>
            <button class="back-to-menu-btn">VOLTAR</button>
        </div>
    </div>

    <div id="game-screen" class="screen">
        <div id="game-hud">
            <div class="hud-column">
                <div class="hud-item">
                    <span>SANIDADE:</span> <span id="hud-sanity">100%</span>
                    <div id="sanity-bar-container"><div id="sanity-bar"></div></div>
                </div>
                <div class="hud-item">
                    <span>INTIMIDADE:</span> <span id="hud-intimacy">100%</span>
                    <div id="intimacy-bar-container"><div id="intimacy-bar"></div></div>
                </div>
                <div class="hud-item">
                    <span>SA√öDE DA PORTA:</span> <span id="hud-door-health">100%</span>
                    <div id="door-health-bar-container"><div id="door-health-bar"></div></div>
                </div>
            </div>
            <div class="hud-column">
                <div id="clock-display">
                    DIA <span id="hud-day">1</span> - <span id="hud-time">00:00</span>
                </div>
                <div class="hud-item">
                    <span>TASKS:</span> <span id="hud-tasks">0/8</span>
                </div>
                <div class="hud-item">
                    <span>RECUSAS:</span> <span id="hud-refusals">3</span>
                </div>
            </div>
        </div>

        <div id="apartment-hub-view" class="active-view">
            <div class="hub-container">
                <h2>Apartamento de Carol</h2>
                <pre id="apartment-art">
+------------------------------------------------------+
| JANELA BARRICADA                                     |
|                                                      |
|   [CONSERTOS] (A porta precisa de reparos)           |
|                                                      |
|   [R√ÅDIO] (Chiado... vozes...)                       |
|                                                      |
|   [TV] (Transmiss√£o...)                              |
|                                                      |
|   [TERMINAL] (Eu preciso focar)                      |
|                                                      |
|                                     [PORTA] >>>      |
+------------------------------------------------------+
                </pre>
                <div class="hub-actions">
                    <button id="hub-repair-btn">CONSERTAR PORTA (Gasta 1h)</button>
                    <button id="hub-radio-btn">OUVIR R√ÅDIO (<span id="radio-uses">2</span>/2)</button>
                    <button id="hub-tv-btn">VER TV (<span id="tv-uses">1</span>/1)</button>
                    <button id="hub-terminal-btn">FOCAR (<span id="terminal-uses">3</span>/3)</button>
                    <button id="hub-door-btn" class="hidden">VERIFICAR PORTA</button>
                </div>
                <div id="hub-display-log">
                    <p>Dia 1. Eu tenho que sobreviver.</p>
                </div>
            </div>
        </div>

        <div id="peephole-overlay" class="hidden">
            <pre id="visitor-ascii-art"></pre>
            <div id="peephole-ui">
                <div id="tool-display"><p>An√°lise visual...</p></div>
                <button id="scan-visitor-btn">SCANNER BIOL√ìGICO (<span id="scanner-uses">1</span>/1)</button>
                <div id="dialogue-options"></div>
                <div id="decision-buttons" class="hidden">
                    <button id="open-door-btn">ABRIR PORTA</button>
                    <button id="deny-visitor-btn">N√ÉO ABRIR</button>
                </div>
            </div>
            <button id="exit-peephole-btn">PARAR DE OLHAR</button>
        </div>
    </div>

    <div id="tv-watch-screen" class="screen">
        <div class="menu-container">
            <h2>TRANSMISS√ÉO DE EMERG√äNCIA</h2>
            <pre id="tv-art">
     .---------------.
    /     0     0     \
   (    \_______/    )
    \     1111111     /
     '---------------'
            </pre>
            <div id="tv-dialogue-box">
                <p id="tv-response">Selecione uma pergunta...</p>
            </div>
            <div id="tv-choices"></div>
            <button id="close-tv-btn">DESLIGAR TV</button>
        </div>
    </div>

    <div id="meeting-screen" class="screen">
        <div class="meeting-container">
            <h2 class="meeting-title">REUNI√ÉO DO GRUPO - DIA <span id="meeting-day">1</span></h2>
            <p style="color: #aaa;">Escolha um membro para interagir ou selecione uma task</p>
            
            <div class="group-grid" id="group-members"></div>
            
            <div class="interaction-panel" id="interaction-panel">
                <p style="color: #555;">Selecione um membro do grupo...</p>
            </div>

            <div style="margin-top: 30px; border-top: 2px solid #ff0; padding-top: 20px;">
                <h3 style="color: #ff0;">TASK DO DIA</h3>
                <p id="daily-task-description" style="color: #fff; margin: 15px 0;"></p>
                <div id="task-choices"></div>
            </div>
        </div>
    </div>

    <div id="game-over-screen" class="screen">
        <div class="menu-container">
            <h2 id="game-over-title">FIM DE JOGO</h2>
            <p id="game-over-message" style="margin: 20px 0; font-size: 1.2em;"></p>
            
            <div id="game-over-stats" class="hidden">
                <h3>--- RESULTADOS DA MISS√ÉO ---</h3>
                <pre id="stats-breakdown"></pre>
                <div id="final-ranking"></div>
            </div>
            
            <button class="back-to-menu-btn">VOLTAR AO MENU</button>
        </div>
    </div>

    <script>
// ===== AUDIO SYSTEM =====
let audioEnabled = false;
let audioContext = null;

const sounds = {
    menuMusic: new Audio('./menu_music.mp3'),
    gameMusic: new Audio('./game_music.mp3'),
    knock: new Audio('./knock.mp3'),
    doorOpen: new Audio('./door_open.mp3'),
    doorDeny: new Audio('./door_deny.mp3'),
    select: new Audio('./select.mp3'),
    radio: new Audio('./radio.mp3'),
    terminal: new Audio('./terminal.mp3'),
    tv: new Audio('./tv.mp3'),
    alarm: new Audio('./alarm.mp3'),
    win: new Audio('./win.mp3'),
    lose: new Audio('./lose.mp3'),
    meeting: new Audio('./meeting.mp3'),
    // Novos sons
    repair: new Audio('./repair.mp3'), // Som de conserto (use um som de martelo/ferramenta)
    scan: new Audio('./scan.mp3'),     // Som de scanner (use um som de computador/bipe)
    doorDamage: new Audio('./door_damage.mp3') // Som de batida forte
};

let masterVolume = 0.3;
let sfxVolume = 0.5;

Object.keys(sounds).forEach(key => {
    sounds[key].addEventListener('error', (e) => {
        console.error(`Erro ao carregar ${key}:`, sounds[key].src);
        if(key === 'menuMusic') updateAudioStatus(`‚ùå Erro: ${key}.mp3 n√£o encontrado`);
    });
});

function updateAudioStatus(message) {
    const statusEl = document.getElementById('audio-state');
    if (statusEl) statusEl.textContent = message;
}

function enableAudio() {
    audioEnabled = true;
    try {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        if (audioContext.state === 'suspended') audioContext.resume();
    } catch (e) { console.log('AudioContext not supported:', e); }
    
    sounds.select.volume = 0.01;
    sounds.select.play().then(() => {
        sounds.select.pause();
        sounds.select.currentTime = 0;
        updateAudioStatus('‚úÖ √Åudio Habilitado');
        document.getElementById('enable-audio-btn').style.display = 'none';
        setVolume();
        sounds.menuMusic.play().catch(e => updateAudioStatus('‚ö†Ô∏è √Åudio parcialmente bloqueado'));
    }).catch(e => updateAudioStatus('‚ùå √Åudio bloqueado pelo navegador'));
}

function setVolume() {
    sounds.menuMusic.volume = masterVolume;
    sounds.gameMusic.volume = masterVolume;
    Object.keys(sounds).forEach(key => {
        if (key !== 'menuMusic' && key !== 'gameMusic') {
            sounds[key].volume = sfxVolume * 0.7;
        }
    });
}

function playSound(soundName) {
    if (!audioEnabled || !sounds[soundName]) return;
    try {
        sounds[soundName].currentTime = 0;
        sounds[soundName].play().catch(e => console.log(`Error playing ${soundName}:`, e));
    } catch (e) { console.log(`Exception playing ${soundName}:`, e); }
}

function stopSound(soundName) {
    if (sounds[soundName]) {
        sounds[soundName].pause();
        sounds[soundName].currentTime = 0;
    }
}

function stopAllMusic() {
    stopSound('menuMusic');
    stopSound('gameMusic');
}

sounds.menuMusic.loop = true;
sounds.gameMusic.loop = true;

// ===== GAME DATA =====
const gameData = {
    simulation: {
        secondsPerMinute: 5,
        hoursPerDay: 5,
        totalDaysToSurvive: 8,
        initialRefusals: 3,
        dailyFocusUses: 3,
        dailyRadioUses: 2,
        dailyTVUses: 1,
        dailyScannerUses: 1, // Nova mec√¢nica
        repairAmount: 25 // Nova mec√¢nica
    },
    
    groupMembers: [
        { id: "m1", name: "Marcus", role: "L√≠der", status: "Determinado", intimacy: 50 },
        { id: "m2", name: "Ana", role: "M√©dica", status: "Cansada", intimacy: 50 },
        { id: "m3", name: "Leo", role: "T√©cnico", status: "Nervoso", intimacy: 50 },
        { id: "m4", name: "Sara", role: "Psic√≥loga", status: "Calma", intimacy: 50 },
        { id: "m5", name: "Diego", role: "Militar", status: "Alerta", intimacy: 50 },
        { id: "m6", name: "Julia", role: "Cientista", status: "Curiosa", intimacy: 50 }
    ],
    
    interactions: [
        { id: "talk", label: "CONVERSAR", intimacyChange: 5, sanityChange: 3 },
        { id: "help", label: "OFERECER AJUDA", intimacyChange: 10, sanityChange: -5 },
        { id: "joke", label: "FAZER PIADA", intimacyChange: 8, sanityChange: 5 },
        { id: "share", label: "COMPARTILHAR MEDO", intimacyChange: 15, sanityChange: -10 },
        { id: "distance", label: "MANTER DIST√ÇNCIA", intimacyChange: -5, sanityChange: 2 }
    ],
    
    tasks: [
        { id: "t1", title: "Buscar Suprimentos", description: "O grupo precisa de comida e √°gua.", choices: [{ text: "Ir ao supermercado (arriscado)", intimacy: 15, sanity: -10 }, { text: "Procurar em casas pr√≥ximas (seguro)", intimacy: 8, sanity: -5 }] },
        { id: "t2", title: "Fortificar Base", description: "Precisamos refor√ßar as defesas.", choices: [{ text: "Barricada externa (cansativo)", intimacy: 12, sanity: -15 }, { text: "Trancar portas internas (simples)", intimacy: 5, sanity: -5 }] },
        { id: "t3", title: "Procurar Sobreviventes", description: "Captamos um sinal de r√°dio.", choices: [{ text: "Investigar o sinal (perigoso)", intimacy: 20, sanity: -20 }, { text: "Ignorar (seguro)", intimacy: -10, sanity: 5 }] },
        { id: "t4", title: "Manter Comunica√ß√£o", description: "O r√°dio est√° falhando.", choices: [{ text: "Consertar com pe√ßas (t√©cnico)", intimacy: 10, sanity: -5 }, { text: "Buscar novo r√°dio (arriscado)", intimacy: 15, sanity: -15 }] },
        { id: "t5", title: "Cuidar dos Feridos", description: "Ana precisa de ajuda m√©dica.", choices: [{ text: "Buscar rem√©dios (perigoso)", intimacy: 18, sanity: -12 }, { text: "Improvisar com o que temos", intimacy: 8, sanity: -8 }] },
        { id: "t6", title: "Investigar a Mente Coletiva", description: "Julia quer estudar 'Eles'.", choices: [{ text: "Ajudar na pesquisa", intimacy: 12, sanity: -20 }, { text: "Recusar por seguran√ßa", intimacy: -5, sanity: 5 }] },
        { id: "t7", title: "Planejar Evacua√ß√£o", description: "Marcus quer um plano de fuga.", choices: [{ text: "Estudar rotas de escape", intimacy: 10, sanity: -8 }, { text: "Focar em resistir aqui", intimacy: 5, sanity: -5 }] },
        { id: "t8", title: "Decis√£o Final", description: "√â o √∫ltimo dia. O que fazemos?", choices: [{ text: "Resistir at√© o resgate", intimacy: 20, sanity: -15 }, { text: "Tentar escapar sozinhos", intimacy: -20, sanity: 10 }] }
    ],
    
    // ===== VISITANTES EXPANDIDOS =====
    visitors: [
        // --- VISITANTES ORIGINAIS (Atualizados com denyDamage) ---
        {
            id: "v001", type: "Outro", name: "Sra. Henderson",
            idleArt: `     .---------------.\n    /     0     0     \n   (    \\_______/    )\n    \\     1111111     /\n     '---------------'\n"ESTOU FELIZ, CAROL."`,
            dialogues: [
                { prompt: "O que voc√™ quer?", response: `     .---------------.\n    /     0     0     \n   (    \\_______/    )\n    \\     1111111     /\n     '---------------'\n"QUE VOCE SE JUNTE A NOS."`, sanity: -5 },
                { prompt: "V√° embora!", response: `     .---------------.\n    /     0     0     \n   (    \\_______/    )\n    \\     1111111     /\n     '---------------'\n"NOS VOLTAREMOS."`, sanity: -3 }
            ],
            outcomes: {
                open: { art: `\n .-------------------.\n|   BEM-VINDA       |\n|   A JUN√á√ÉO        |\n '-------------------'`, sanity: -100 },
                deny: { art: `     .---------------.\n    /     0     0     \n   (    \\_______/    )\n    \\     1111111     /\n     '---------------'\n"NOS VOLTAREMOS."`, sanity: 5, denyDamage: 5 }
            }
        },
        {
            id: "v002", type: "Humano", name: "Sobrevivente",
            idleArt: `     !#?$*!#?%&!$#@?\n    /     O     O     \n   (      /\\_/\\      )\n    \\     9?8!2*4     /\n     '---------------'\n"ABRE!! POR FAVOR!!"`,
            dialogues: [
                { prompt: "Quem √© voc√™?", response: `     !#?$*!#?%&!$#@?\n    /     O     O     \n   (      /\\_/\\      )\n    \\     9?8!2*4     /\n     '---------------'\n"SOU HUMANO! ME DEIXA ENTRAR!"`, sanity: 5 },
                { prompt: "Como posso confiar?", response: `     !#?$*!#?%&!$#@?\n    /     O     O     \n   (      /\\_/\\      )\n    \\     9?8!2*4     /\n     '---------------'\n"EU TO SOZINHO! POR FAVOR!"`, sanity: 3 }
            ],
            outcomes: {
                open: { art: `"OBRIGADO... OBRIGADO..."\n\n(A pessoa desmaia\n de exaust√£o)`, sanity: 20, intimacy: 10 },
                deny: { art: `     !#?$*!#?%&!$#@?\n    /     o     o     \n   (      /\\_/\\      )\n    \\     ......      /\n     '---------------'\n"NAO!! ... eu...\n me sinto... feliz."`, sanity: -25, denyDamage: 10 }
            }
        },
        {
            id: "v003", type: "Outro", name: "A Isca",
            idleArt: `     !#?$*!#?%&!$#@?\n    /     o     o     \n   (      /\\_/\\      )\n    \\     ?????????     /\n     '---------------'\n"EU SOU HUMANA!"`,
            dialogues: [
                { prompt: "Prove que √© humana", response: `     !#?$*!#?%&!$#@?\n    /     o     o     \n   (      /\\_/\\      )\n    \\     ?????????     /\n     '---------------'\n"EU... EU... ABRA!"`, sanity: -5 }
            ],
            outcomes: {
                open: { art: `     .---------------.\n    /     0     0     \n   (    \\_______/    )\n    \\     1111111     /\n     '---------------'\n"TE PEGUEI, CAROL."`, sanity: -100 },
                deny: { art: `     .---------------.\n    /     0     0     \n   (    \\_______/    )\n    \\     1111111     /\n     '---------------'\n"... Quase."`, sanity: 10, denyDamage: 5 }
            }
        },
        {
            id: "v004", type: "Outro", name: "Crian√ßa Chorando",
            idleArt: `     !#?$*!#?%&!$#@?\n    /     .     .     \n   (      >___<      )\n    \    ( ( ( ) )    /\n     '---------------'\n"(choro)... por favor...\n me ajuda... t√° escuro..."`,
            dialogues: [
                { prompt: "Onde est√£o seus pais?", response: `     !#?$*!!#?%&!$#@?\n    /     .     .     \n   (      >___<      )\n    \    ( ( ( ) )    /\n     '---------------'\n"Eles... eles se foram!\n Eu t√¥ com medo! Abre!"`, sanity: -8 },
                 { prompt: "Eu n√£o posso", response: `     !#?$*!#?%&!$#@?\n    /     .     .     \n   (      >___<      )\n    \    ( ( ( ) )    /\n     '---------------'\n"VOC√ä VAI ME DEIXAR AQUI?!\n POR FAVOR!!"`, sanity: -12 }
            ],
            outcomes: {
                open: { art: `     .---------------.\n    /     0     0     \n   (    \\_______/    )\n    \     1111111     /\n     '---------------'\n"TOLA. NOS ESTAMOS FELIZES."`, sanity: -100 },
                deny: { art: `     !#?$*!#?%&!$#@?\n    /     o     o     \n   (      >___<      )\n    \    ( ( ( ) )    /\n     '---------------'\n"(o choro para)\n ...\n (a crian√ßa sorri)\n ...\n NOS VEMOS EM BREVE."`, sanity: 15, denyDamage: 10 }
            }
        },
        {
            id: "v005", type: "Outro", name: "Membro do Grupo Ferido",
            idleArt: `     !#?$*!#?%&!$#@?\n    /     O     o     \n   (      /\\_/\\      )\n    \     !@#$?!?     /\n     '---------------'\n"CAROL! SOU EU, LEO! ABRE!"`,
            dialogues: [
                { prompt: "Leo? O que aconteceu?", response: `     !#?$*!#?%&!$#@?\n    /     O     o     \n   (      /\\_/\\      )\n    \     !@#$?!?     /\n     '---------------'\n"Fui pego... me ajuda...\n Eu t√¥ sangrando! R√°pido!"`, sanity: -10 },
                { prompt: "Prove que √© voc√™!", response: `     !#?$*!#?%&!$#@?\n    /     O     o     \n   (      /\\_/\\      )\n    \     !@#$?!?     /\n     '---------------'\n"N√£o temos tempo! ABRE LOGO!\n ...\n (tosse)\n ...\n Por favor... Carol..."`, sanity: -15 }
            ],
            outcomes: {
                open: { art: `     .---------------.\n    /     0     0     \n   (    \\_______/    )\n    \     1111111     /\n     '---------------'\n"Leo esta conosco agora.\n E voce tambem."`, sanity: -100 },
                deny: { art: `     !#?$*!#?%&!$#@?\n    /     0     0     \n   (    \\_______/    )\n    \     1111111     /\n     '---------------'\n"QUE PENA, CAROL.\n ELE ESTAVA TAO FELIZ."`, sanity: 10, denyDamage: 10 }
            }
        },
        {
            id: "v006", type: "Outro", name: "Voz Familiar",
            idleArt: `     ? ? ? ? ? ? ? ? ?\n    /     ?     ?     \n   (        ?        )\n    \     ? ? ? ?     /\n     '---------------'\n"Filha... abre a porta.\n √â a mam√£e."`,
            dialogues: [
                { prompt: "M√£e? Voc√™... voc√™ morreu!", response: `     ? ? ? ? ? ? ? ? ?\n    /     ?     ?     \n   (        ?        )\n    \     ? ? ? ?     /\n     '---------------'\n"N√£o, querida. Eu estou aqui.\n Eu estou feliz.\n Deixe-me entrar."`, sanity: -20 },
                 { prompt: "Eu n√£o acredito em voc√™!", response: `     ? ? ? ? ? ? ? ? ?\n    /     ?     ?     \n   (        ?        )\n    \     ? ? ? ?     /\n     '---------------'\n"Carol... por favor.\n Eu senti sua falta.\n Junte-se a mim."`, sanity: -15 }
            ],
            outcomes: {
                open: { art: `\n .-------------------.\n|   FINALMENTE      |\n|   ESTAMOS JUNTAS  |\n '-------------------'`, sanity: -100 },
                deny: { art: `     .---------------.\n    /     0     0     \n   (    \\_______/    )\n    \     1111111     /\n     '---------------'\n"VOCE SEMPRE FOI\n UMA DECEPCAO."`, sanity: 20, denyDamage: 15 }
            }
        },
        {
            id: "v007", type: "Humano", name: "Ana (Membro do Grupo)",
            idleArt: `     !#?$*!#?%&!$#@?\n    /     o _ o     \n   (      (o o)      )\n    \      \\_/       /\n     '---------------'\n"Carol! Abre! Sou eu, Ana!\n Voltei da busca."`,
            dialogues: [
                { prompt: "Qual a senha de ontem?", response: `     !#?$*!#?%&!$#@?\n    /     o _ o     \n   (      (o o)      )\n    \      \\_/       /\n     '---------------'\n"'P√¥r do sol vermelho'.\n Abre logo, eu ouvi 'Eles'!"`, sanity: 5 },
                { prompt: "Voc√™ est√° sozinha?", response: `     !#?$*!#?%&!$#@?\n    /     o _ o     \n   (      (o o)      )\n    \      \\_/       /\n     '---------------'\n"Sim! Por favor, Carol!\n Est√° frio!"`, sanity: 3 }
            ],
            outcomes: {
                open: { art: `"Ufa... obrigada.\nConsegui alguns suprimentos.\nEstou exausta."\n\n(Ana entra e tranca a porta)`, sanity: 15, intimacy: 20 },
                deny: { art: `     !#?$*!#?%&!$#@?\n    /     O _ O     \n   (      (o o)      )\n    \      \\_/       /\n     '---------------'\n"CAROL?! O QUE VOC√ä...\n N√ÉO! ELES EST√ÉO AQUI!!\n N√É√É√É..."\n(Sons de luta, depois sil√™ncio)`, sanity: -30, intimacy: -40, denyDamage: 10 }
            }
        },
        {
            id: "v008", type: "Humano", name: "Comerciante",
            idleArt: `     $$$$$$$$$$$$$$$\n    /     O . O     \n   (      (---)      )\n    \     [$$$]      /\n     '---------------'\n"Ei! Psst! Abre!\n Eu tenho coisas boas!\n Troca r√°pida!"`,
            dialogues: [
                { prompt: "O que voc√™ tem?", response: `     $$$$$$$$$$$$$$$\n    /     O . O     \n   (      (---)      )\n    \     [$$$]      /\n     '---------------'\n"Rem√©dios, pe√ßas...\n Eu s√≥ quero comida enlatada.\n Uma troca justa."`, sanity: 0 },
                { prompt: "√â seguro?", response: `     $$$$$$$$$$$$$$$\n    /     O . O     \n   (      (---)      )\n    \     [$$$]      /\n     '---------------'\n"Eu sou humano! Eu s√≥ quero\n sobreviver, igual a voc√™.\n R√°pido, sim ou n√£o?"`, sanity: 0 }
            ],
            outcomes: {
                open: { art: `(Voc√™ troca rapidamente\n algumas latas por pe√ßas\n de r√°dio)\n\n"Bom neg√≥cio."\n(Ele desaparece na n√©voa)\n\n(+1 Uso de R√°dio)`, sanity: -5, intimacy: 0, bonus: "radio" },
                deny: { art: `     $$$$$$$$$$$$$$$\n    /     o . o     \n   (      (---)      )\n    \     [$$$]      /\n     '---------------'\n"Tudo bem... sua perda.\n Idiota."\n(Ele vai embora resmungando)`, sanity: 5, denyDamage: 2 }
            }
        },
        {
            id: "v009", type: "Outro", name: "Oficial de Quarentena",
            idleArt: `     .---------------.\n    /    -     -    \n   (      [---]      )\n    \     (o o)     /\n     '---------------'\n"ORDEM DO GOVERNO!\nAbra para inspe√ß√£o imediata!\nEstamos evacuando a √°rea."`,
            dialogues: [
                { prompt: "Qual sua identifica√ß√£o?", response: `     .---------------.\n    /    -     -    \n   (      [---]      )\n    \     (o o)     /\n     '---------------'\n"N√£o temos tempo para\n burocracia! Abra a porta\n ou usaremos for√ßa!"`, sanity: -10 },
                { prompt: "Para onde vamos?", response: `     .---------------.\n    /    -     -    \n   (      [---]      )\n    \     (o o)     /\n     '---------------'\n"Para um lugar seguro.\n Onde todos somos... felizes.\n Agora abra."`, sanity: -15 }
            ],
            outcomes: {
                open: { art: `     .---------------.\n    /     0     0     \n   (    \\_______/    )\n    \     1111111     /\n     '---------------'\n"Obrigado por cooperar.\nA Jun√ß√£o te recebe."`, sanity: -100 },
                deny: { art: `     .---------------.\n    /    -     -    \n   (      [---]      )\n    \     (o o)     /\n     '---------------'\n"Resist√™ncia anotada.\nN√≥s voltaremos.\nTodos se juntar√£o."`, sanity: 10, denyDamage: 20 }
            }
        },
        {
            id: "v010", type: "Outro", name: "O Silencioso",
            idleArt: `     ... ... ... ...\n    /     .     .     \n   (                 )\n    \      (---)      /\n     '---------------'\n(A pessoa n√£o diz nada.\n Apenas bate ritmicamente.\n ...\n Ela levanta um bilhete\n amassado para o visor)\n \n BILHETE: "SOCORRO. MUDO."`,
            dialogues: [
                { prompt: "Voc√™ est√° ferido?", response: `     ... ... ... ...\n    /     .     .     \n   (                 )\n    \      (---)      /\n     '---------------'\n(A pessoa balan√ßa a cabe√ßa\n 'sim' freneticamente.\n Aponta para a garganta\n e depois para a porta.)`, sanity: -5 },
                { prompt: "V√° embora!", response: `     ... ... ... ...\n    /     .     .     \n   (                 )\n    \      (---)      /\n     '---------------'\n(A pessoa bate com mais\n for√ßa, os olhos se\n arregalando. Parece\n desesperada... ou zangada.)`, sanity: -3 }
            ],
            outcomes: {
                open: { art: `(No momento em que a\n tranca gira, a pessoa\n para de tremer.\n Ela olha para voc√™.)\n\n     .---------------.\n    /     0     0     \n   (    \\_______/    )\n    \     1111111     /\n     '---------------'\n"Palavras n√£o s√£o\n necess√°rias...\n para a felicidade."`, sanity: -100 },
                deny: { art: `     ... ... ... ...\n    /     .     .     \n   (                 )\n    \      (---)      /\n     '---------------'\n(A pessoa para de bater.\n Ela fica im√≥vel por\n um longo tempo.\n ...\n Ent√£o, lentamente,\n se vira e vai embora.)`, sanity: 10, denyDamage: 10 }
            }
        },

        // --- 10 NOVOS HUMANOS ---
        {
            id: "vH_01", type: "Humano", name: "T√©cnico da Cidade",
            idleArt: `     $$$__$$$$$$$$$$
    /     O _ O     \
   (     (_____)     )
    \    |  |  |    /
     '---------------'
"Servi√ßo da cidade!
Estou checando os disjuntores.
Ouvi um alarme neste andar."`,
            dialogues: [
                { prompt: "Que alarme?", response: `"Um alarme silencioso. Anti-pane.\nS√≥ preciso de 2 minutos.\nN√£o me fa√ßa registrar\n'N√£o-cooperativo'."`, sanity: -3 }
            ],
            outcomes: {
                open: { art: `(O homem entra, mexe
na sua caixa de for√ßa
por um minuto e sai.)

"Tudo certo. Mantenha a
cabe√ßa baixa."

(+1 Uso de Focar hoje)`, sanity: 10, bonus: "focus" },
                deny: { art: `"Tudo bem. Seu risco.
Se a energia cair,
n√£o me ligue."`, sanity: 0, denyDamage: 5 }
            }
        },
        {
            id: "vH_02", type: "Humano", name: "Vizinho Assustado",
            idleArt: `     !?!?!!?!!?!?!?
    /     o . o     \
   (      (> <)      )
    \     /___\\      /
     '---------------'
"Sou eu, do 4B!
Por favor, minha porta cedeu!
S√≥ preciso de um minuto!"`,
            dialogues: [
                { prompt: "O que aconteceu?", response: `"Eu n√£o sei! Eles...
eles quase entraram!
Por favor, s√≥ at√© eles irem!"`, sanity: 0 }
            ],
            outcomes: {
                open: { art: `(O homem entra,
hiperventilando.
Ele fica no canto por
meia hora e depois sai.)

"Obrigado... obrigado..."`, sanity: 10, intimacy: 5 },
                deny: { art: `"N√ÉO! N√ÉO!
(som de vidro quebrando)
...
...
...
(sil√™ncio)"`, sanity: -20, denyDamage: 5 }
            }
        },
        {
            id: "vH_03", type: "Humano", name: "Carteiro Perdido",
            idleArt: `     [MAIL] [MAIL]
    /     - . -     \
   (      [___]      )
    \     / | \\      /
     '---------------'
"Correio! ... Eu acho.
Eu... eu n√£o sei onde
estou. Estou perdido.
S√≥ quero descansar os p√©s."`,
            dialogues: [
                { prompt: "N√£o h√° mais correio.", response: `"Eu sei... eu sei...
√â s√≥... o h√°bito.
Eu s√≥ preciso sentar.
Por favor."`, sanity: 5 }
            ],
            outcomes: {
                open: { art: `(O velho carteiro entra,
senta no ch√£o,
bebe um copo d'√°gua
e adormece.)

(Ele se foi pela manh√£.)`, sanity: 10, intimacy: 5 },
                deny: { art: `"Tudo bem...
Eu vou...
s√≥ continuar andando."`, sanity: -10, denyDamage: 1 }
            }
        },
        {
            id: "vH_04", type: "Humano", name: "Adolescente",
            idleArt: `     !!**!!**!!**!!
    /     > _ <     \
   (      (o o)      )
    \     /___\\      /
     '---------------'
"EI! ABRE!
Estou procurando meus pais!
Voc√™ os viu?!?"`,
            dialogues: [
                { prompt: "Eu n√£o vi ningu√©m.", response: `"MENTIRA!
Eles moram no 7A!
Me deixa passar por a√≠!
√â um atalho!"`, sanity: -5 }
            ],
            outcomes: {
                open: { art: `(A garota entra correndo,
ignora voc√™, e tenta
abrir a janela barricada.)

"Droga! In√∫til!"
(Ela sai batendo a porta.)`, sanity: -10, intimacy: -5 },
                deny: { art: `"SEU...
(ela chuta a porta)
EU VOU ACHAR ELES!
E VOC√ä VAI SE ARREPENDER!"`, sanity: 0, denyDamage: 15 }
            }
        },
        {
            id: "vH_05", type: "Humano", name: "Policial Ferido",
            idleArt: `     - - - POLICE - -
    /     o _ O     \
   (     (-----)     )
    \     |BADGE|     /
     '---------------'
"Oficial Miller.
Fui ferido. Preciso
de um kit m√©dico.
R√°pido!"`,
            dialogues: [
                { prompt: "O que aconteceu?", response: `"Uma emboscada.
Eu... eu n√£o sei.
Eles parecem humanos,
mas n√£o s√£o..."`, sanity: 5 }
            ],
            outcomes: {
                open: { art: `(Voc√™ d√° a ele
algumas bandagens.)

"Obrigado, civil.
Mantenha-se trancada.
N√£o confie em ningu√©m."
(Ele sai mancando.)`, sanity: 10, intimacy: 10 },
                deny: { art: `"Droga...
Eu vou...
Eu vou ter que...
(som de corpo caindo)
...
(sil√™ncio)"`, sanity: -15, denyDamage: 5 }
            }
        },
        {
            id: "vH_06", type: "Humano", name: "Jornalista",
            idleArt: `     [PRESS] [PRESS]
    /     O . O     \
   (      [CAM]      )
    \     / | \\      /
     '---------------'
"Sou da WORN News.
Estou documentando...
isso. Voc√™ tem uma hist√≥ria?"`,
            dialogues: [ // <-- Erro estava aqui ("dialogies")
                { prompt: "V√° embora! √â perigoso!", response: `"Esse √© o ponto!
O mundo precisa saber!
O que voc√™ viu?
Eles s√£o... felizes?"`, sanity: -5 }
            ],
            outcomes: {
                open: { art: `(Voc√™ conta a ela
sobre as vozes, a TV,
a Sra. Henderson.)

"Incr√≠vel...
Obrigada. Fique segura."
(Ela anota tudo e sai.)`, sanity: 5, intimacy: 0 },
                deny: { art: `"Covarde!
A hist√≥ria ser√° contada,
com ou sem voc√™!"`, sanity: 0, denyDamage: 5 }
            }
        },
        {
            id: "vH_07", type: "Humano", name: "M√∫sico",
            idleArt: `     (---) (---)
    /     o . o     \
   (      ( | )      )
    \     [GUITAR]    /
     '---------------'
"Ei...
Eu sei que √© o fim do mundo,
mas... posso tocar uma
m√∫sica para voc√™?"`,
            dialogues: [
                { prompt: "Isso √© uma piada?", response: `"N√£o...
M√∫sica √© tudo o que
restou. S√≥ uma."`, sanity: 10 }
            ],
            outcomes: {
                open: { art: `(Ele senta do lado de fora.
Voc√™ abre uma fresta.
Ele toca uma melodia
linda e triste.)

(Sua sanidade se recupera
um pouco.)`, sanity: 25, intimacy: 0 },
                deny: { art: `"Tudo bem...
O sil√™ncio vence
mais uma vez."`, sanity: -5, denyDamage: 1 }
            }
        },
        {
            id: "vH_08", type: "Humano", name: "Cozinheiro",
            idleArt: `     [CHEF] [HAT]
    /     o _ o     \
   (      (---)      )
    \     / | \\      /
     '---------------'
"Eu tenho p√£o!
P√£o de verdade!
Troco por um lugar
seguro por uma noite!"`,
            dialogues: [
                { prompt: "Como voc√™ fez p√£o?", response: `"Eu... eu tenho
meu pr√≥prio gerador.
Farinha... fermento...
√â a √∫ltima fornada."`, sanity: 5 }
            ],
            outcomes: {
                open: { art: `(Ele lhe d√° metade
de um p√£o quente.
O cheiro √©... normal.
√â maravilhoso.)

(Voc√™ se sente humana.)`, sanity: 30, intimacy: 5 },
                deny: { art: `"Sua perda.
Vou ter que comer
tudo sozinho."`, sanity: 0, denyDamage: 2 }
            }
        },
        {
            id: "vH_09", type: "Humano", name: "Ca√ßador",
            idleArt: `     > > > > > > > >
    /     O _ O     \
   (      ( | )      )
    \     [RIFLE]     /
     '---------------'
"Estou rastreando um 'deles'.
Ele entrou neste corredor.
Viu alguma coisa?"`,
            dialogues: [
                { prompt: "N√£o vi nada.", response: `"Mentira.
Seus sensores de movimento
dispararam.
Abra a porta.
Vou checar seu apartamento."`, sanity: -10 }
            ],
            outcomes: {
                open: { art: `(Ele entra, varre
o apartamento com a arma.
Ele parece desapontado.)

"Limpo.
...
Sorte a sua."
(Ele sai.)`, sanity: -10, intimacy: -5 },
                deny: { art: `"Se voc√™ est√°
escondendo um...
voc√™ √© um deles.
Vou voltar."`, sanity: -5, denyDamage: 10 }
            }
        },
        {
            id: "vH_10", type: "Humano", name: "Parente Distante",
            idleArt: `     ? ? ? ? ? ? ?
    /     o . o     \
   (      (---)      )
    \     / | \\      /
     '---------------'
"Carol? √â voc√™?
Sou eu... seu primo, Mark!
Daquele churrasco... lembra?"`,
            dialogues: [
                { prompt: "Eu n√£o lembro de voc√™.", response: `"Isso magoa!
Olha, eu sei que n√£o
somos pr√≥ximos, mas...
eu sou fam√≠lia."`, sanity: 0 }
            ],
            outcomes: {
                open: { art: `(√â ele mesmo.
Ele parece... normal.
Voc√™s conversam sem
jeito por 10 minutos.)

"Ok, valeu.
Vou tentar o 3C."`, sanity: 5, intimacy: 5 },
                deny: { art: `"S√©rio?
Depois de tudo...
...
Tudo bem, Carol.
Tudo bem."`, sanity: -10, intimacy: -10, denyDamage: 5 }
            }
        },

        // --- 10 NOVOS INFECTADOS ---
        {
            id: "vI_01", type: "Outro", name: "O Pregador",
            idleArt: `     + + + + + + + +
    /     0 . 0     \
   (     \\___/     )
    \     [LIVRO]     /
     '---------------'
"Irm√£! Abra!
A Jun√ß√£o √© a salva√ß√£o!
A felicidade eterna
bate √† sua porta!"`,
            dialogues: [
                { prompt: "Isso n√£o √© salva√ß√£o.", response: `"√â paz!
Sem medo! Sem dor!
Eles nos amam.
Eles s√≥ querem nos
fazer felizes!"`, sanity: -10 }
            ],
            outcomes: {
                open: { art: `"BEM-VINDA AO REBANHO!
VOC√ä EST√Å T√ÉO FELIZ AGORA!"`, sanity: -100 },
                deny: { art: `"Voc√™ rejeita a paz...
...
Mas a paz
n√£o rejeita voc√™.
N√≥s voltaremos."`, sanity: 10, denyDamage: 10 }
            }
        },
        {
            id: "vI_02", type: "Outro", name: "O B√™bado",
            idleArt: `     ~ ~ ~ ~ ~ ~ ~
    /     o _ O     \
   (      (   )      )
    \     / | \\      /
     '---------------'
"(hic)... eei...
(barulho de garrafa)
Acho que errei o...
(hic)... o apartamento.
Me ajuda aqui..."`,
            dialogues: [
                { prompt: "Voc√™ n√£o mora aqui.", response: `"Claro que... (hic)
moro!
Abre a√≠, vizinha...
(ele ri)
...
feliz..."`, sanity: -5 }
            ],
            outcomes: {
                open: { art: `(O 'b√™bado' para de
balan√ßar. Ele te olha.)

     .---------------.
    /     0     0     \
   (    \\_______/    )
    \     1111111     /
     '---------------'
"Obrigado...
...pela bebida."`, sanity: -100 },
                deny: { art: `"(hic)...
Mal... malvada...
Vou s√≥... (hic)...
dormir aqui."`, sanity: 5, denyDamage: 5 }
            }
        },
        {
            id: "vI_03", type: "Outro", name: "Falso Resgate",
            idleArt: `     [RESGATE] [FORTE]
    /     O _ O     \
   (     (-----)     )
    \    (N√ìS)    /
     '---------------'
"SOBREVIVENTE!
Somos da Equipe de Resgate.
Abra a porta!
Estamos evacuando este pr√©dio!"`,
            dialogues: [
                { prompt: "Qual √© a sua unidade?", response: `"N√£o h√° tempo!
Temos mais 10 para pegar!
Abra agora ou ser√°
deixada para tr√°s!"`, sanity: -10 }
            ],
            outcomes: {
                open: { art: `"√ìtimo.
O resgate...
...
...chegou.
Estamos todos aqui.
E estamos felizes."`, sanity: -100 },
                deny: { art: `"RECUSA EM EVACUAR.
(ele fala num r√°dio)
'Unidade 7, a moradora
do 5B est√° feliz...
...ela s√≥ n√£o sabe ainda.'
(eles batem forte)"`, sanity: 5, denyDamage: 25 }
            }
        },
        {
            id: "vI_04", type: "Outro", name: "A Voz do R√°dio",
            idleArt: `     ( ( ( O ) ) )
    /     ? ? ?     \
   (       ? ?       )
    \     ? ? ?     /
     '---------------'
"...est√°tica...
Carol? Voc√™ est√° a√≠?
Sou eu... do r√°dio...
Consegui te rastrear.
Abra!"`,
            dialogues: [
                { prompt: "Como sabe meu nome?", response: `"N√≥s sabemos
de todos.
Eu sou a voz que
voc√™ confia.
Deixe-me entrar."`, sanity: -15 }
            ],
            outcomes: {
                open: { art: `(A porta se abre
para uma figura
de pura est√°tica
e dentes.)

"A JUN√á√ÉO √â PAC√çFICA.
N√ÉO RESISTA."`, sanity: -100 },
                deny: { art: `"...
(o r√°dio no seu quarto
liga sozinho)
'N√≥s voltaremos.'
(e desliga)"`, sanity: -10, denyDamage: 10 }
            }
        },
        {
            id: "vI_05", type: "Outro", name: "O Entregador",
            idleArt: `     [PIZZA] [PIZZA]
    /     o _ o     \
   (      (---)      )
    \     [CAIXA]     /
     '---------------'
"Entrega!
Pepperoni e queijo.
R√°pido, vai esfriar.
...
O que? O mundo acabou?
Ningu√©m me avisou."`,
            dialogues: [
                { prompt: "Isso √© doentio.", response: `"Doentio √© deixar
essa del√≠cia esfriar.
Vamos l√°. Estamos todos
com fome. Estamos
felizes."`, sanity: -10 }
            ],
            outcomes: {
                open: { art: `(Voc√™ abre.
A caixa de pizza
est√° vazia,
exceto por um √∫nico
olho que pisca.)

"Hora da sobremesa."`, sanity: -100 },
                deny: { art: `"Sem gorjeta?
Que rude.
...
N√≥s voltaremos."`, sanity: 10, denyDamage: 5 }
            }
        },
        {
            id: "vI_06", type: "Outro", name: "Falso T√©cnico",
            idleArt: `     [FERRAMENTAS]
    /     O _ o     \
   (     (-----)     )
    \     / | \\      /
     '---------------'
"Ei, ouvi uma batida
forte.
Sua porta parece danificada.
Eu posso consertar.
De gra√ßa."`,
            dialogues: [
                { prompt: "Como sabe disso?", response: `"Eu ouvi!
Eu sou... um carpinteiro.
S√≥ quero ajudar.
Deixe-me ver o dano."`, sanity: -5 }
            ],
            outcomes: {
                open: { art: `(Ele olha a porta.)
"Ah, sim.
Est√° bem ruim.
Mas n√£o se preocupe...
...
(ele sorri)
...
N√£o vai mais precisar dela."`, sanity: -100 },
                deny: { art: `"Tudo bem.
Mas da pr√≥xima vez
que baterem...
(ele bate na porta)
...pode n√£o aguentar."`, sanity: 0, denyDamage: 20 }
            }
        },
        {
            id: "vI_07", type: "Outro", name: "O Imitador",
            idleArt: `     ? ? ? ? ? ? ?
    /     ? . ?     \
   (       ? ?       )
    \     ? ? ?     /
     '---------------'
"(Sua pr√≥pria voz)
'Droga, esqueci a chave.
Ei! Abre a√≠!
Sou eu!'"`,
            dialogues: [
                { prompt: "Quem √© voc√™?", response: `"(Sua voz, irritada)
'Como assim, quem sou eu?
Sou eu, Carol!
Para de brincadeira
e abre a porta!'"`, sanity: -20 }
            ],
            outcomes: {
                open: { art: `(Voc√™ abre e n√£o
v√™ ningu√©m.
...
Voc√™ sente um arrepio
atr√°s de voc√™.)

(Uma voz no seu ouvido:)
"Agora... eu sou voc√™.
E estamos felizes."`, sanity: -100 },
                deny: { art: `"(Sua voz, zangada)
'Tudo bem!
Eu fico aqui fora!
Mas quando ELES chegarem,
a culpa √© sua!'"`, sanity: 10, denyDamage: 10 }
            }
        },
        {
            id: "vI_08", type: "Outro", name: "A Oferta de Paz",
            idleArt: `     . . . . . . .
    /     o . o     \
   (      (---)      )
    \     [CAIXA]     /
     '---------------'
"N√≥s n√£o somos hostis.
A Jun√ß√£o √© paz.
Por favor, aceite este
presente.
Comida. √Ågua."`,
            dialogues: [
                { prompt: "O que tem na caixa?", response: `"Felicidade.
O fim do seu medo.
Abra e veja."`, sanity: -10 }
            ],
            outcomes: {
                open: { art: `(Voc√™ abre.
A caixa est√° cheia
de uma n√©voa negra
que te envolve.)

"Voc√™ √© bem-vinda."`, sanity: -100 },
                deny: { art: `"Voc√™ rejeita
nossa generosidade.
...
Que pena.
Ainda assim,
n√≥s te amamos."`, sanity: 10, denyDamage: 5 }
            }
        },
        {
            id: "vI_09", type: "Outro", name: "A V√≠tima",
            idleArt: `     ! ! ! ! ! ! ! !
    /     > _ <     \
   (      (o o)      )
    \     /___\\      /
     '---------------'
"(Sons de choro e p√¢nico)
ELES EST√ÉO ME SEGUINDO!
ME DEIXA ENTRAR!
POR FAVOR!
(Batidas fren√©ticas)"`,
            dialogues: [
                { prompt: "Onde eles est√£o?", response: `"NA ESCADA!
ELES V√ÉO ME PEGAR!
ABRE! ABRE! ABRE!"`, sanity: -15 }
            ],
            outcomes: {
                open: { art: `(Voc√™ abre.
A pessoa entra correndo,
te empurra e tranca
a porta atr√°s de si.)

(Ela se vira para voc√™.)
     .---------------.
    /     0     0     \
   (    \\_______/    )
    \     1111111     /
     '---------------'
"T√£o segura...
...
T√£o feliz."`, sanity: -100 },
                deny: { art: `"N√ÉO! N√ÉO!
(Grito terr√≠vel)
...
...
(Uma voz calma:)
'Ah...
...
...
finalmente...
...
feliz.'"`, sanity: -25, denyDamage: 20 }
            }
        },
        {
            id: "vI_10", type: "Outro", name: "Sil√™ncio Total",
            idleArt: `     . . . . . . .
    /               \
   (                 )
    \                 /
     '---------------'
(N√£o h√° batida.
N√£o h√° som.
Apenas...
...
uma sensa√ß√£o.
Voc√™ olha pelo visor.
N√£o h√° nada l√°.)`,
            dialogues: [
                { prompt: "Tem algu√©m a√≠?", response: `(Sil√™ncio.
...
...
...
De repente, uma
figura sombria
cobre o visor!)
     .---------------.
    /     0     0     \
   (    \\_______/    )
    \     1111111     /
     '---------------'
"SIM."`, sanity: -30 }
            ],
            outcomes: {
                open: { art: `(Voc√™ abre a porta
para o nada.
...
Voc√™ sente o vento
entrar...
...
e a porta bate
atr√°s de voc√™.
Voc√™ est√° do lado de fora.)

"Bem-vinda."`, sanity: -100 },
                deny: { art: `(A figura sombria
desaparece do visor.)

(Sil√™ncio.
...
Voc√™ se sente...
observada.)`, sanity: 15, denyDamage: 5 }
            }
        },
    ],
    
    radioMessages: [
        { text: "...est√°tica... algu√©m a√≠?...", sanity: 10 },
        { text: "A Jun√ß√£o √© pac√≠fica. N√£o resista.", sanity: -10 },
        { text: "(melodia estranha e calmante)", sanity: -5 },
        { text: "Dia 3... ainda resistindo... √°gua acabando...", sanity: 8 }
    ],
    
    tvQuestions: [
        { id: "q1", text: "Quem √© voc√™?", response: "Eu era o Senador Miles. Agora sou N√≥s. Sou a Sra. Henderson. Sou todos.", used: false },
        { id: "q2", text: "O que voc√™s querem?", response: "Paz. O fim da infelicidade. Voc√™s sofrem tanto... n√≥s somos a cura.", used: false },
        { id: "q3", text: "Como eu luto?", response: "(risada calma) Voc√™ n√£o pode. A resist√™ncia √© exaust√£o. Cedo ou tarde, voc√™ vai descansar.", used: false },
        { id: "q4", text: "O que √© a Jun√ß√£o?", response: "Somos um. Uma mente. Felicidade eterna. Sem dor, sem medo, sem solid√£o.", used: false }
    ]
};

// ===== GAME STATE =====
let game = {
    sanity: 100,
    intimacy: 100,
    doorHealth: 100, // Nova mec√¢nica
    day: 1,
    tasksCompleted: 0,
    time: { h: 0, m: 0 },
    dailyRefusals: 3,
    focusUses: 3,
    radioUses: 2,
    tvUses: 1,
    scannerUses: 1, // Nova mec√¢nica
    currentVisitor: null,
    selectedMember: null,
    gameLoop: null,
    state: "menu",
    isDecisionMade: false,
    scoreData: {
        humansSaved: 0,
        infectedDenied: 0,
        infectedAdmitted: 0,
        humansDenied: 0
    }
};

// ===== INIT =====
document.addEventListener('DOMContentLoaded', () => {
    setTimeout(() => {
        showScreen('mainMenu'); // Chamada
        updateAudioStatus('‚ö†Ô∏è Clique para habilitar √°udio');
        document.getElementById('enable-audio-btn').style.display = 'inline-block';
        checkAudioFiles();
    }, 1500);

    document.getElementById('enable-audio-btn').onclick = enableAudio;
    document.getElementById('start-game-btn').onclick = startGame;
    document.getElementById('how-to-play-btn').onclick = () => { playSound('select'); showScreen('howToPlay'); }; // Chamada
    document.getElementById('settings-btn').onclick = () => { playSound('select'); showScreen('settings'); }; // Chamada
    document.getElementById('credits-btn').onclick = () => { playSound('select'); showScreen('credits'); }; // Chamada
    
    document.querySelectorAll('.back-to-menu-btn').forEach(btn => {
        btn.onclick = () => {
            playSound('select');
            stopAllMusic();
            if (audioEnabled) sounds.menuMusic.play().catch(e => console.log('Menu music error:', e));
            showScreen('mainMenu'); // Chamada
        };
    });

    document.getElementById('music-volume').addEventListener('input', (e) => {
        masterVolume = parseFloat(e.target.value);
        setVolume(); playSound('select');
    });
    document.getElementById('sfx-volume').addEventListener('input', (e) => {
        sfxVolume = parseFloat(e.target.value);
        setVolume(); playSound('select');
    });
    
    setVolume();

    // Hub buttons
    document.getElementById('hub-repair-btn').onclick = useRepair; // Bot√£o mudado
    document.getElementById('hub-radio-btn').onclick = useRadio;
    document.getElementById('hub-tv-btn').onclick = openTVScreen;
    document.getElementById('hub-terminal-btn').onclick = useFocus;
    document.getElementById('hub-door-btn').onclick = enterPeephole;

    // Peephole buttons
    document.getElementById('exit-peephole-btn').onclick = exitPeephole;
    document.getElementById('open-door-btn').onclick = () => makeDecision('open');
    document.getElementById('deny-visitor-btn').onclick = () => makeDecision('deny');
    document.getElementById('scan-visitor-btn').onclick = useScanner; // Nova mec√¢nica
    
    document.getElementById('close-tv-btn').onclick = closeTVScreen;
});

function checkAudioFiles() {
    const requiredFiles = [
        'menu_music.mp3', 'game_music.mp3', 'knock.mp3', 'door_open.mp3', 
        'door_deny.mp3', 'select.mp3', 'radio.mp3', 'terminal.mp3', 'tv.mp3', 
        'alarm.mp3', 'win.mp3', 'lose.mp3', 'meeting.mp3',
        'repair.mp3', 'scan.mp3', 'door_damage.mp3' // Novos sons
    ];
    console.log('üìÅ ARQUIVOS DE √ÅUDIO NECESS√ÅRIOS (coloque na mesma pasta do HTML):');
    requiredFiles.forEach(file => console.log(`  - ${file}`));
}

// ===== CORE FUNCTIONS =====

// ***** FUN√á√ÉO CORRIGIDA *****
// Esta fun√ß√£o agora usa um "mapa" de objetos para encontrar as telas.
// Isso corrige o erro 'mainMenu-screen' vs 'main-menu-screen'.
function showScreen(name) {
    const screens = {
        loading: document.getElementById('loading-screen'),
        mainMenu: document.getElementById('main-menu-screen'),
        howToPlay: document.getElementById('how-to-play-screen'),
        credits: document.getElementById('credits-screen'),
        settings: document.getElementById('settings-screen'),
        game: document.getElementById('game-screen'),
        tvWatch: document.getElementById('tv-watch-screen'),
        meeting: document.getElementById('meeting-screen'),
        gameOver: document.getElementById('game-over-screen')
    };
    
    // Esconde todas as telas
    Object.values(screens).forEach(s => {
        if (s) s.classList.remove('active');
    });
    
    // Mostra a tela correta
    if (screens[name]) {
        screens[name].classList.add('active');
        game.state = name;
    } else {
        console.error("showScreen: Tela n√£o encontrada:", name);
    }
}

function updateHUD() {
    // Sanidade
    document.getElementById('hud-sanity').textContent = Math.round(game.sanity) + '%';
    document.getElementById('sanity-bar').style.width = game.sanity + '%';
    if (game.sanity <= 30) document.getElementById('sanity-bar').style.background = '#f00';
    else if (game.sanity <= 60) document.getElementById('sanity-bar').style.background = '#ff0';
    else document.getElementById('sanity-bar').style.background = '#fff';

    // Intimidade
    document.getElementById('hud-intimacy').textContent = Math.round(game.intimacy) + '%';
    document.getElementById('intimacy-bar').style.width = game.intimacy + '%';
    if (game.intimacy <= 30) document.getElementById('intimacy-bar').style.background = '#f00';
    else if (game.intimacy <= 60) document.getElementById('intimacy-bar').style.background = '#ff0';
    else document.getElementById('intimacy-bar').style.background = '#0f0';

    // Sa√∫de da Porta
    document.getElementById('hud-door-health').textContent = Math.round(game.doorHealth) + '%';
    document.getElementById('door-health-bar').style.width = game.doorHealth + '%';
    if (game.doorHealth <= 30) document.getElementById('door-health-bar').style.background = '#f00';
    else if (game.doorHealth <= 60) document.getElementById('door-health-bar').style.background = '#ff0';
    else document.getElementById('door-health-bar').style.background = '#0ff';

    // Outros
    document.getElementById('hud-day').textContent = game.day;
    document.getElementById('hud-time').textContent = `${String(game.time.h).padStart(2, '0')}:${String(game.time.m).padStart(2, '0')}`;
    document.getElementById('hud-tasks').textContent = `${game.tasksCompleted}/8`;
    document.getElementById('hud-refusals').textContent = game.dailyRefusals;
    
    // Contadores de Uso
    document.getElementById('radio-uses').textContent = game.radioUses;
    document.getElementById('tv-uses').textContent = game.tvUses;
    document.getElementById('terminal-uses').textContent = game.focusUses;
    
    // Desabilitar bot√µes
    document.getElementById('hub-radio-btn').disabled = (game.radioUses <= 0);
    document.getElementById('hub-tv-btn').disabled = (game.tvUses <= 0);
    document.getElementById('hub-terminal-btn').disabled = (game.focusUses <= 0);
    document.getElementById('hub-repair-btn').disabled = (game.doorHealth >= 100);
    document.getElementById('deny-visitor-btn').disabled = (game.dailyRefusals <= 0);
}

function changeSanity(amount) {
    if (game.state === 'gameOver') return;
    game.sanity = Math.max(0, Math.min(100, game.sanity + amount));
    updateHUD();
    if (game.sanity <= 0) endGame('sanity');
}

function changeIntimacy(amount) {
    if (game.state === 'gameOver') return;
    game.intimacy = Math.max(0, Math.min(100, game.intimacy + amount));
    updateHUD();
    // Falha por intimidade √© checada no fim do dia
}

function changeDoorHealth(amount) {
    if (game.state === 'gameOver') return;
    game.doorHealth = Math.max(0, Math.min(100, game.doorHealth + amount));
    updateHUD();
    if (game.doorHealth <= 0) endGame('door');
}

function setHubMessage(text) {
    document.getElementById('hub-display-log').innerHTML = `<p>${text}</p>`;
}

// ===== GAME START =====
function startGame() {
    playSound('select');
    stopSound('menuMusic');
    setTimeout(() => sounds.gameMusic.play().catch(e => console.log('Game music blocked')), 100);
    
    game = {
        sanity: 100,
        intimacy: 100,
        doorHealth: 100,
        day: 1,
        tasksCompleted: 0,
        time: { h: 0, m: 0 },
        dailyRefusals: gameData.simulation.initialRefusals,
        focusUses: gameData.simulation.dailyFocusUses,
        radioUses: gameData.simulation.dailyRadioUses,
        tvUses: gameData.simulation.dailyTVUses,
        scannerUses: gameData.simulation.dailyScannerUses,
        currentVisitor: null,
        selectedMember: null,
        gameLoop: null,
        state: "game",
        isDecisionMade: false,
        scoreData: { humansSaved: 0, infectedDenied: 0, infectedAdmitted: 0, humansDenied: 0 }
    };
    
    gameData.tvQuestions.forEach(q => q.used = false);
    gameData.groupMembers.forEach(m => m.intimacy = 50);
    
    setVolume();
    showScreen('game');
    
    document.getElementById('game-over-stats').classList.add('hidden');
    document.getElementById('stats-breakdown').innerHTML = '';
    document.getElementById('final-ranking').innerHTML = '';
    
    updateHUD();
    setHubMessage("Dia 1. Eu tenho que sobreviver. 8 dias. 8 tasks.");
    
    game.gameLoop = setInterval(gameTick, 1000 / gameData.simulation.secondsPerMinute);
}

function gameTick() {
    if (game.state !== 'game') return;
    
    game.time.m++;
    
    if (game.time.m >= 60) {
        game.time.m = 0;
        game.time.h++;
        
        triggerKnock();
        
        if (game.time.h >= gameData.simulation.hoursPerDay) {
            endDay();
        }
    }
    
    updateHUD();
}

function endDay() {
    clearInterval(game.gameLoop);
    if (game.intimacy < 60) {
        endGame('intimacy');
    } else {
        startMeeting();
    }
}

// ===== HUB ACTIONS =====
function useRepair() { // Nova fun√ß√£o
    playSound('repair');
    setHubMessage(`Voc√™ gasta uma hora refor√ßando a porta. (+${gameData.simulation.repairAmount}% Sa√∫de da Porta)`);
    changeDoorHealth(gameData.simulation.repairAmount);
    
    game.time.h++;
    game.time.m = 0;
    
    if (game.time.h >= gameData.simulation.hoursPerDay) {
        endDay();
    } else {
        triggerKnock(); // Outra batida
    }
}

function useRadio() {
    if (game.radioUses <= 0) return;
    playSound('radio');
    game.radioUses--;
    setTimeout(() => {
        const msg = gameData.radioMessages[Math.floor(Math.random() * gameData.radioMessages.length)];
        changeSanity(msg.sanity);
        setHubMessage(`[R√ÅDIO]: "${msg.text}"`);
        updateHUD();
    }, 500);
}

function useFocus() {
    if (game.focusUses <= 0) return;
    playSound('terminal');
    game.focusUses--;
    changeSanity(15);
    setHubMessage("Eu me concentro. Lembro quem eu sou. Isso me mant√©m forte.");
    updateHUD();
}

function openTVScreen() {
    if (game.tvUses <= 0) return;
    playSound('tv');
    game.tvUses--;
    showScreen('tvWatch');
    
    const tvChoices = document.getElementById('tv-choices');
    tvChoices.innerHTML = '';
    
    gameData.tvQuestions.forEach(q => {
        if (!q.used) {
            const btn = document.createElement('button');
            btn.textContent = q.text;
            btn.onclick = () => {
                playSound('select');
                document.getElementById('tv-response').textContent = q.response;
                changeSanity(-5);
                q.used = true;
                btn.disabled = true;
            };
            tvChoices.appendChild(btn);
        }
    });
}

function closeTVScreen() {
    playSound('select');
    showScreen('game');
    setHubMessage("Desliguei a TV. Essas vozes... elas sabem muito.");
    updateHUD();
}

// ===== VISITOR SYSTEM =====
function triggerKnock() {
    if (game.state !== 'game') return;
    
    playSound('knock');
    playSound('alarm');
    
    game.currentVisitor = gameData.visitors[Math.floor(Math.random() * gameData.visitors.length)];
    document.getElementById('hub-door-btn').classList.remove('hidden');
    setHubMessage("ALGU√âM EST√Å BATENDO NA PORTA!");
    
    // Desabilitar a√ß√µes do hub
    document.getElementById('hub-repair-btn').disabled = true;
    document.getElementById('hub-radio-btn').disabled = true;
    document.getElementById('hub-tv-btn').disabled = true;
    document.getElementById('hub-terminal-btn').disabled = true;
}

function enterPeephole() {
    playSound('select');
    game.state = 'peephole';
    document.getElementById('peephole-overlay').classList.remove('hidden');
    document.getElementById('hub-door-btn').classList.add('hidden');
    game.isDecisionMade = false;
    
    document.getElementById('visitor-ascii-art').textContent = game.currentVisitor.idleArt;
    document.getElementById('tool-display').innerHTML = `<p>An√°lise: ${game.currentVisitor.name}</p>`;
    
    // Resetar e habilitar scanner
    const scanBtn = document.getElementById('scan-visitor-btn');
    scanBtn.disabled = (game.scannerUses <= 0);
    scanBtn.innerHTML = `SCANNER BIOL√ìGICO (<span id="scanner-uses">${game.scannerUses}</span>/1)`;
    
    const dialogueOptions = document.getElementById('dialogue-options');
    dialogueOptions.innerHTML = '';
    
    game.currentVisitor.dialogues.forEach(d => {
        const btn = document.createElement('button');
        btn.textContent = d.prompt;
        btn.onclick = () => {
            playSound('select');
            document.getElementById('visitor-ascii-art').textContent = d.response;
            changeSanity(d.sanity);
            document.getElementById('decision-buttons').classList.remove('hidden');
        };
        dialogueOptions.appendChild(btn);
    });
    
    if (game.currentVisitor.dialogues.length === 0) {
         document.getElementById('decision-buttons').classList.remove('hidden');
    }
}

function useScanner() { // Nova fun√ß√£o
    if (game.scannerUses <= 0) return;
    
    playSound('scan');
    game.scannerUses--;
    
    const toolDisplay = document.getElementById('tool-display');
    if (game.currentVisitor.type === 'Humano') {
        toolDisplay.innerHTML = `<p style="color: #0f0;">BIOSSINAL: HUMANO (N√≠vel de Estresse: Alto)</p>`;
    } else {
        toolDisplay.innerHTML = `<p style="color: #f00;">BIOSSINAL: AN√îMALO (Assinatura Desconhecida)</p>`;
    }
    
    document.getElementById('scan-visitor-btn').disabled = true;
    document.getElementById('scanner-uses').textContent = game.scannerUses;
}

function exitPeephole() {
    if (game.isDecisionMade) return;
    
    playSound('select');
    document.getElementById('peephole-overlay').classList.add('hidden');
    game.state = 'game';
    setHubMessage("Me afastei da porta. O tempo continua...");
    
    // Reabilitar a√ß√µes do hub
    document.getElementById('hub-repair-btn').disabled = (game.doorHealth >= 100);
    document.getElementById('hub-radio-btn').disabled = (game.radioUses <= 0);
    document.getElementById('hub-tv-btn').disabled = (game.tvUses <= 0);
    document.getElementById('hub-terminal-btn').disabled = (game.focusUses <= 0);
    
    updateHUD();
}

function makeDecision(choice) {
    if (game.isDecisionMade) return;
    game.isDecisionMade = true;
    
    const outcome = game.currentVisitor.outcomes[choice];
    const visitorType = game.currentVisitor.type;
    
    if (choice === 'open') {
        playSound('doorOpen');
        if (visitorType === 'Humano') game.scoreData.humansSaved++;
        else game.scoreData.infectedAdmitted++;
    } else { // 'deny'
        playSound('doorDeny');
        if (visitorType === 'Humano') game.scoreData.humansDenied++;
        else game.scoreData.infectedDenied++;
        
        game.dailyRefusals--;
        
        // Aplicar dano √† porta
        if (outcome.denyDamage) {
            playSound('doorDamage');
            changeDoorHealth(-outcome.denyDamage);
            setHubMessage(`A porta tremeu com o impacto. (-${outcome.denyDamage}% Sa√∫de da Porta)`);
        }
    }
    
    document.getElementById('visitor-ascii-art').textContent = outcome.art;
    document.getElementById('dialogue-options').innerHTML = '';
    document.getElementById('decision-buttons').classList.add('hidden');
    document.getElementById('scan-visitor-btn').disabled = true;
    
    setTimeout(() => {
        if (outcome.sanity) changeSanity(outcome.sanity);
        if (outcome.intimacy) changeIntimacy(outcome.intimacy);
        
        if (outcome.bonus === "radio") {
            game.radioUses++;
            setHubMessage("Voc√™ trocou suprimentos por pe√ßas. (+1 Uso de R√°dio)");
        }
        if (outcome.bonus === "focus") {
            game.focusUses++;
            setHubMessage("O t√©cnico consertou algo. (+1 Uso de Focar)");
        }
        
        if (game.state !== 'gameOver') {
            document.getElementById('peephole-overlay').classList.add('hidden');
            game.state = 'game';
            if (!outcome.bonus) {
                 setHubMessage(`Decis√£o tomada. ${choice === 'open' ? 'Abri a porta.' : 'Recusei a entrada.'}`);
            }
            
            // Reabilitar a√ß√µes
            document.getElementById('hub-repair-btn').disabled = (game.doorHealth >= 100);
            document.getElementById('hub-radio-btn').disabled = (game.radioUses <= 0);
            document.getElementById('hub-tv-btn').disabled = (game.tvUses <= 0);
            document.getElementById('hub-terminal-btn').disabled = (game.focusUses <= 0);
        }
    }, 3000);
}

// ===== MEETING SYSTEM =====
function startMeeting() {
    playSound('meeting');
    showScreen('meeting');
    document.getElementById('meeting-day').textContent = game.day;
    game.state = 'meeting';
    
    const grid = document.getElementById('group-members');
    grid.innerHTML = '';
    gameData.groupMembers.forEach(member => {
        const card = document.createElement('div');
        card.className = 'member-card';
        card.innerHTML = `<div class="member-name">${member.name}</div>
            <div class="member-status">${member.role}</div>
            <div class="member-status">${member.status}</div>
            <div class="intimacy-level">Intimidade: ${member.intimacy}%</div>`;
        card.onclick = (e) => { playSound('select'); selectMember(member, e.currentTarget); };
        grid.appendChild(card);
    });
    
    const task = gameData.tasks[game.tasksCompleted];
    document.getElementById('daily-task-description').textContent = task.description;
    
    const taskChoices = document.getElementById('task-choices');
    taskChoices.innerHTML = '';
    task.choices.forEach(choice => {
        const btn = document.createElement('button');
        btn.textContent = choice.text;
        btn.onclick = () => { playSound('select'); completeTask(choice); };
        taskChoices.appendChild(btn);
    });
}

function selectMember(member, cardElement) {
    game.selectedMember = member;
    document.querySelectorAll('.member-card').forEach(c => c.classList.remove('selected'));
    cardElement.classList.add('selected');
    
    const panel = document.getElementById('interaction-panel');
    panel.innerHTML = `<h3 style="color: #ff0;">${member.name} - ${member.role}</h3>
        <p style="color: #aaa;">"${member.status}"</p>
        <p style="color: #0f0;">Intimidade: ${member.intimacy}%</p>
        <div class="interaction-buttons"></div>`;
    
    const btns = panel.querySelector('.interaction-buttons');
    gameData.interactions.forEach(action => {
        const btn = document.createElement('button');
        btn.textContent = action.label;
        btn.onclick = () => { playSound('select'); interact(member, action, cardElement); };
        btns.appendChild(btn);
    });
}

function interact(member, action, cardElement) {
    member.intimacy = Math.max(0, Math.min(100, member.intimacy + action.intimacyChange));
    changeSanity(action.sanityChange);
    
    const avg = gameData.groupMembers.reduce((sum, m) => sum + m.intimacy, 0) / gameData.groupMembers.length;
    game.intimacy = avg;
    
    selectMember(member, cardElement);
    updateHUD();
}

function completeTask(choice) {
    game.tasksCompleted++;
    changeIntimacy(choice.intimacy);
    changeSanity(choice.sanity);
    
    if (game.state === 'gameOver') return;
    
    if (game.tasksCompleted >= 8) {
        endGame('win');
        return;
    }
    
    if (game.intimacy < 60) {
        endGame('intimacy');
        return;
    }
    
    // Reset para o pr√≥ximo dia
    game.day++;
    game.time = { h: 0, m: 0 };
    game.dailyRefusals = gameData.simulation.initialRefusals;
    game.focusUses = gameData.simulation.dailyFocusUses;
    game.radioUses = gameData.simulation.dailyRadioUses;
    game.tvUses = gameData.simulation.dailyTVUses;
    game.scannerUses = gameData.simulation.dailyScannerUses; // Reset do scanner
    
    showScreen('game');
    updateHUD();
    setHubMessage(`Dia ${game.day}. A luta continua. Tasks: ${game.tasksCompleted}/8`);
    
    game.gameLoop = setInterval(gameTick, 1000 / gameData.simulation.secondsPerMinute);
}

// ===== GAME OVER & RANKING =====
function getRanking(score) {
    if (score >= 5000) return "S (Sobrevivente Perfeito)";
    if (score >= 4000) return "A (Guardi√£o)";
    if (score >= 2500) return "B (Resistente)";
    if (score >= 1000) return "C (Sobrevivente Cauteloso)";
    if (score > 0) return "D (Sobreviveu por Pouco)";
    return "F (Perdido)";
}

function endGame(reason) {
    if (game.state === 'gameOver') return;
    
    clearInterval(game.gameLoop);
    game.state = 'gameOver';
    showScreen('gameOver');
    
    const title = document.getElementById('game-over-title');
    const message = document.getElementById('game-over-message');
    
    stopSound('gameMusic');
    
    if (reason === 'win') {
        playSound('win');
        title.textContent = 'VIT√ìRIA!';
        message.textContent = `Dia 8. Voc√™ completou todas as tasks. O grupo sobreviveu. A ajuda est√° vindo. Voc√™ manteve sua humanidade... e sua sanidade.`;
    } else if (reason === 'sanity') {
        playSound('lose');
        title.textContent = 'CONEX√ÉO ESTABELECIDA';
        message.textContent = 'Eu me sinto... calma. Eu me sinto... feliz. Eu n√£o sou mais eu. Eu sou N√≥s.';
    } else if (reason === 'intimacy') {
        playSound('lose');
        title.textContent = 'EXPULSA DO GRUPO';
        message.textContent = 'O grupo votou. Voc√™ n√£o √© mais confi√°vel. Voc√™ est√° sozinha. Eles est√£o vindo...';
    } else if (reason === 'door') { // Novo final
        playSound('lose');
        playSound('doorDamage');
        title.textContent = 'PORTA DESTRU√çDA';
        message.textContent = 'As batidas se tornaram ensurdecedoras. A madeira se partiu. Eles entraram. Eles est√£o... felizes.';
    }
    
    // --- C√°lculo de Pontos Atualizado ---
    const tasksBonus = game.tasksCompleted * 150;
    const sanityBonus = Math.round(game.sanity) * 10;
    const intimacyBonus = Math.round(game.intimacy) * 10;
    const doorHealthBonus = Math.round(game.doorHealth) * 5; // B√¥nus pela sa√∫de da porta
    
    const humansSavedPoints = game.scoreData.humansSaved * 500;
    const infectedDeniedPoints = game.scoreData.infectedDenied * 200;
    
    const humansDeniedPenalty = game.scoreData.humansDenied * -300;
    const infectedAdmittedPenalty = game.scoreData.infectedAdmitted * -1000;
    
    const totalScore = tasksBonus + sanityBonus + intimacyBonus + doorHealthBonus +
                       humansSavedPoints + infectedDeniedPoints + 
                       humansDeniedPenalty + infectedAdmittedPenalty;
                       
    const ranking = getRanking(totalScore);

    const statsText = `
Tasks Completas: ${game.tasksCompleted}/8  (Pontos: ${tasksBonus})
Sanidade Final:  ${Math.round(game.sanity)}%    (B√¥nus: ${sanityBonus})
Intimidade Final: ${Math.round(game.intimacy)}%   (B√¥nus: ${intimacyBonus})
Sa√∫de da Porta:  ${Math.round(game.doorHealth)}%    (B√¥nus: ${doorHealthBonus})
-----------------------------------
Humanos Salvos:    ${game.scoreData.humansSaved}   (Pontos: ${humansSavedPoints})
Infectados Negados: ${game.scoreData.infectedDenied}  (Pontos: ${infectedDeniedPoints})
-----------------------------------
Humanos Negados:   ${game.scoreData.humansDenied}   (Penal.: ${humansDeniedPenalty})
Infectados Aceitos: ${game.scoreData.infectedAdmitted}  (Penal.: ${infectedAdmittedPenalty})
===================================
PONTUA√á√ÉO TOTAL: ${totalScore}
    `;
    
    document.getElementById('game-over-stats').classList.remove('hidden');
    document.getElementById('stats-breakdown').textContent = statsText;
    document.getElementById('final-ranking').textContent = `RANKING: ${ranking}`;
}
    </script>
</body>
</html>